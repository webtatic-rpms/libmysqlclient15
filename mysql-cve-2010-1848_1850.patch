CVE-2010-1850
http://bugs.mysql.com/bug.php?id=53237
http://bazaar.launchpad.net/~mysql/mysql-server/mysql-5.0-bugteam/revision/2859

CVE-2010-1848
http://bugs.mysql.com/bug.php?id=53371
http://bazaar.launchpad.net/~mysql/mysql-server/mysql-5.0-bugteam/revision/2861

diff -pruN mysql-5.0.77.orig/sql/sql_parse.cc mysql-5.0.77/sql/sql_parse.cc
--- mysql-5.0.77.orig/sql/sql_parse.cc	2010-05-20 11:43:40.000000000 +0200
+++ mysql-5.0.77/sql/sql_parse.cc	2010-05-20 11:45:39.000000000 +0200
@@ -2028,8 +2028,23 @@ bool dispatch_command(enum enum_server_c
     if (thd->copy_db_to(&table_list.db, &table_list.db_length))
       break;
     pend= strend(packet);
+    uint arg_length= pend - packet;
+    
+    /* Check given table name length. */
+    if (arg_length >= packet_length || arg_length > NAME_LEN)
+    {
+      my_message(ER_UNKNOWN_COM_ERROR, ER(ER_UNKNOWN_COM_ERROR), MYF(0));
+      break;
+    }
     thd->convert_string(&conv_name, system_charset_info,
-			packet, (uint) (pend-packet), thd->charset());
+			packet, arg_length, thd->charset());
+    if (check_table_name (conv_name.str, conv_name.length))
+    {
+      /* this is OK due to convert_string() null-terminating the string */
+      my_error(ER_WRONG_TABLE_NAME, MYF(0), conv_name.str);
+      break;
+    }
+
     table_list.alias= table_list.table_name= conv_name.str;
     packet= pend+1;
 
diff -pruN mysql-5.0.77.orig/tests/mysql_client_test.c mysql-5.0.77/tests/mysql_client_test.c
--- mysql-5.0.77.orig/tests/mysql_client_test.c	2009-01-29 22:45:53.000000000 +0100
+++ mysql-5.0.77/tests/mysql_client_test.c	2010-05-20 11:45:39.000000000 +0200
@@ -115,6 +115,8 @@ static void client_disconnect(void);
 
 #define DIE_UNLESS(expr) \
         ((void) ((expr) ? 0 : (die(__FILE__, __LINE__, #expr), 0)))
+#define DIE_IF(expr) \
+        ((void) ((expr) ? (die(__FILE__, __LINE__, #expr), 0) : 0))
 #define DIE(expr) \
         die(__FILE__, __LINE__, #expr)
 
@@ -16354,6 +16356,49 @@ static void test_bug40365(void)
 
   DBUG_VOID_RETURN;
 }
+
+
+static void test_bug53371()
+{
+  int rc;
+  MYSQL_RES *result;
+
+  myheader("test_bug53371");
+
+  rc= mysql_query(mysql, "DROP TABLE IF EXISTS t1");
+  myquery(rc);
+  rc= mysql_query(mysql, "DROP DATABASE IF EXISTS bug53371");
+  myquery(rc);
+  rc= mysql_query(mysql, "DROP USER 'testbug'@localhost");
+
+  rc= mysql_query(mysql, "CREATE TABLE t1 (a INT)");
+  myquery(rc);
+  rc= mysql_query(mysql, "CREATE DATABASE bug53371");
+  myquery(rc);
+  rc= mysql_query(mysql, "GRANT SELECT ON bug53371.* to 'testbug'@localhost");
+  myquery(rc);
+
+  rc= mysql_change_user(mysql, "testbug", NULL, "bug53371");
+  myquery(rc);
+
+  rc= mysql_query(mysql, "SHOW COLUMNS FROM client_test_db.t1");
+  DIE_UNLESS(rc);
+  DIE_UNLESS(mysql_errno(mysql) == 1142);
+
+  result= mysql_list_fields(mysql, "../client_test_db/t1", NULL);
+  DIE_IF(result);
+
+  rc= mysql_change_user(mysql, opt_user, opt_password, current_db);
+  myquery(rc);
+  rc= mysql_query(mysql, "DROP TABLE t1");
+  myquery(rc);
+  rc= mysql_query(mysql, "DROP DATABASE bug53371");
+  myquery(rc);
+  rc= mysql_query(mysql, "DROP USER 'testbug'@localhost");
+  myquery(rc);
+}
+
+
 /*
   Read and parse arguments and MySQL options from my.cnf
 */
@@ -16653,6 +16698,7 @@ static struct my_tests_st my_tests[]= {
 #ifdef HAVE_SPATIAL
   { "test_bug37956", test_bug37956 },
 #endif
+  { "test_bug53371", test_bug53371 },
   { 0, 0 }
 };
 
