Back-patch upstream patch for CVE-2012-2122.

As of June 2012, this was not a live bug in any RHEL5 build, because the
underlying glibc memcmp implementations did not return values outside the
range of type "char".  But we'll include the fix going forward anyway,
to guard against possible future changes in RHEL5's version of glibc.


diff -Naur mysql-5.0.95.orig/sql/password.c mysql-5.0.95/sql/password.c
--- mysql-5.0.95.orig/sql/password.c	2011-12-16 07:12:41.000000000 -0500
+++ mysql-5.0.95/sql/password.c	2013-01-07 15:08:13.349619715 -0500
@@ -528,7 +528,7 @@
   mysql_sha1_reset(&sha1_context);
   mysql_sha1_input(&sha1_context, buf, SHA1_HASH_SIZE);
   mysql_sha1_result(&sha1_context, hash_stage2_reassured);
-  return memcmp(hash_stage2, hash_stage2_reassured, SHA1_HASH_SIZE);
+  return test(memcmp(hash_stage2, hash_stage2_reassured, SHA1_HASH_SIZE));
 }
 
 
